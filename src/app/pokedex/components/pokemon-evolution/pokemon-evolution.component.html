<section class="card evolution-card">
  <h3 class="card-title">Evolution Chain</h3>

  @if (evolutionTree()) {
  <div class="evo-tree">
    <ng-container
      *ngTemplateOutlet="renderNode; context: { node: evolutionTree() }"
    ></ng-container>
  </div>
  }

  <ng-template #renderNode let-node="node">
    <!-- ðŸ”¥ CASO 1: EVOLUÃ‡ÃƒO PARALELA (SLOWPOKE, EEVEE, ETC.) -->
    @if (node.isParallel) {

    <!-- Pai -->
    <div class="evo-card parent">
      <img [src]="node.image" [alt]="node.name" class="evo-img" />
      <p class="evo-name">{{ node.name | titlecase }}</p>
    </div>

    <div class="arrow-wrapper">
      <span class="arrow">â†“</span>
    </div>

    <!-- Grid de filhos -->
    <div class="evo-grid" [ngClass]="node.layoutClass">
      @for (child of node.children; track child.name) {
      <ng-container
        *ngTemplateOutlet="renderNode; context: { node: child }"
      ></ng-container>
      }
    </div>
    }

    <!-- ðŸ”µ CASO 2: EVOLUÃ‡ÃƒO EM LINHA (CHARMANDER, ETC.) -->
    @else if (node.children?.length === 1) {

    <div class="evo-inline">
      <!-- Pai -->
      <div class="evo-card small">
        <img [src]="node.image" [alt]="node.name" class="evo-img" />
        <p class="evo-name">{{ node.name | titlecase }}</p>
      </div>

      <span class="arrow-inline">â†’</span>

      <!-- Filho Ãºnico -->
      <ng-container
        *ngTemplateOutlet="renderNode; context: { node: node.children[0] }"
      ></ng-container>
    </div>

    }

    <!-- ðŸ”¸ CASO 3: NÃ“ FINAL (SEM FILHOS) -->
    @else {

    <div class="evo-card">
      <img [src]="node.image" [alt]="node.name" class="evo-img" />
      <p class="evo-name">{{ node.name | titlecase }}</p>
      @if (node.details) {
        <p class="evo-details">{{ node.details }}</p>
      }
    </div>

    }
  </ng-template>
</section>
